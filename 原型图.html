<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FundPro - å®æ—¶åŸºé‡‘æ•°æ®ä¸­å¿ƒ</title>
    <style>
        :root {
            /* é…è‰²æ–¹æ¡ˆ - æš—è‰²ä¸“ä¸šé£ */
            --bg-body: #0f172a;       /* æ·±è“é»‘èƒŒæ™¯ */
            --bg-panel: #1e293b;      /* é¢æ¿èƒŒæ™¯ */
            --bg-hover: #334155;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
            
            /* æ¶¨è·Œè‰² (ä¸­å›½æ ‡å‡†) */
            --up: #ef4444;            /* çº¢æ¶¨ */
            --up-bg: rgba(239, 68, 68, 0.15);
            --down: #10b981;          /* ç»¿è·Œ */
            --down-bg: rgba(16, 185, 129, 0.15);
            
            --primary: #3b82f6;       /* å“ç‰Œè“ */
            --sidebar-width: 240px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', system-ui, -apple-system, sans-serif; }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            display: flex;
            height: 100vh;
            overflow: hidden; /* é˜²æ­¢æ•´ä¸ªé¡µé¢æ»šåŠ¨ï¼Œåªæ»šåŠ¨å†…å®¹åŒº */
        }

        /* --- ä¾§è¾¹æ  (Sidebar) --- */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 100;
        }

        .logo-area {
            padding: 20px;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        .nav-item:hover, .nav-item.active {
            background-color: var(--bg-hover);
            color: var(--text-main);
            border-left: 3px solid var(--primary);
        }

        /* --- ä¸»å†…å®¹åŒº (Main Content) --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* é¡¶éƒ¨ Header */
        header {
            height: 64px;
            background-color: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .header-left { display: flex; align-items: center; gap: 15px; }
        .market-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .live-dot { width: 6px; height: 6px; background: currentColor; border-radius: 50%; animation: blink 1.5s infinite; }
        
        /* ä»ªè¡¨ç›˜ç½‘æ ¼å¸ƒå±€ */
        .dashboard-container {
            padding: 24px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 2fr 1fr; /* æ¡Œé¢ï¼šå·¦2å³1 */
            grid-template-rows: auto auto 1fr;
            gap: 24px;
            height: 100%;
        }

        /* å¡ç‰‡é€šç”¨æ ·å¼ */
        .card {
            background-color: var(--bg-panel);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        /* 1. é¡¶éƒ¨æ ¸å¿ƒæ•°æ®å¡ç‰‡ (å æ®æ•´è¡Œ) */
        .fund-header-card {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .fund-info h1 { font-size: 24px; margin-bottom: 4px; }
        .fund-info .code { color: var(--text-muted); font-size: 14px; background: #334155; padding: 2px 6px; border-radius: 4px; }
        
        .price-box { text-align: right; }
        .price-main { font-size: 36px; font-weight: 700; font-family: 'Roboto Mono', monospace; }
        .price-change { font-size: 18px; font-weight: 600; }
        
        .text-up { color: var(--up); }
        .text-down { color: var(--down); }
        .bg-flash-up { animation: flashRed 1s; }
        .bg-flash-down { animation: flashGreen 1s; }

        /* 2. å›¾è¡¨åŒºåŸŸ (å·¦ä¾§) */
        .chart-card {
            grid-column: 1 / 2;
            min-height: 400px;
        }
        .chart-controls { display: flex; gap: 10px; margin-bottom: 15px; }
        .chart-btn { 
            background: transparent; border: 1px solid var(--border); color: var(--text-muted); 
            padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;
        }
        .chart-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        #mainCanvas { width: 100%; height: 100%; min-height: 320px; }

        /* 3. æŒä»“åˆ—è¡¨ (å³ä¾§) */
        .holdings-card {
            grid-column: 2 / 3;
            overflow: hidden;
        }
        .card-title { font-size: 16px; font-weight: 600; margin-bottom: 15px; display: flex; justify-content: space-between; }
        
        .stock-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .stock-table th { text-align: left; color: var(--text-muted); padding-bottom: 10px; font-weight: 500; }
        .stock-table td { padding: 12px 0; border-bottom: 1px solid var(--border); }
        .stock-table tr:last-child td { border-bottom: none; }
        .stock-bar { height: 4px; background: var(--bg-hover); border-radius: 2px; margin-top: 6px; overflow: hidden; }
        .stock-bar-fill { height: 100%; border-radius: 2px; }

        /* æ±‰å ¡èœå• (é»˜è®¤éšè—) */
        .menu-toggle { display: none; font-size: 24px; cursor: pointer; background: none; border: none; color: var(--text-main); }

        /* --- å“åº”å¼è®¾è®¡ (Responsive) --- */
        
        /* å¹³æ¿å°ºå¯¸ */
        @media (max-width: 1024px) {
            .dashboard-container {
                grid-template-columns: 1fr; /* æ”¹ä¸ºå•åˆ— */
                grid-template-rows: auto auto auto;
            }
            .chart-card { grid-column: 1 / -1; }
            .holdings-card { grid-column: 1 / -1; }
        }

        /* æ‰‹æœºå°ºå¯¸ */
        @media (max-width: 768px) {
            :root { --sidebar-width: 0px; } /* éšè—ä¾§è¾¹æ  */
            
            .sidebar {
                position: fixed;
                left: -250px; /* ç§»å‡ºå±å¹• */
                top: 0; bottom: 0;
                width: 250px;
                box-shadow: 2px 0 10px rgba(0,0,0,0.5);
            }
            .sidebar.open { transform: translateX(250px); }
            
            .menu-toggle { display: block; margin-right: 15px; }
            .header-left { gap: 5px; }
            
            .dashboard-container { padding: 16px; gap: 16px; }
            
            /* è°ƒæ•´å¤´éƒ¨å¡ç‰‡å¸ƒå±€ */
            .fund-header-card { flex-direction: column; align-items: flex-start; gap: 10px; }
            .price-box { text-align: left; display: flex; align-items: baseline; gap: 10px; width: 100%; }
            .price-main { font-size: 32px; }
            
            /* éšè—æ¬¡è¦æ•°æ®åˆ— */
            .mobile-hide { display: none; }
        }

        /* åŠ¨ç”»å…³é”®å¸§ */
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        @keyframes flashRed { 0% { background-color: var(--up-bg); } 100% { background-color: var(--bg-panel); } }
        @keyframes flashGreen { 0% { background-color: var(--down-bg); } 100% { background-color: var(--bg-panel); } }

    </style>
</head>
<body>

    <!-- ä¾§è¾¹æ å¯¼èˆª -->
    <aside class="sidebar" id="sidebar">
        <div class="logo-area">
            <span style="font-size: 24px;">ğŸ“Š</span> FundPro
        </div>
        <nav class="nav-menu">
            <a href="#" class="nav-item active"><span>ğŸ </span> å¸‚åœºæ€»è§ˆ</a>
            <a href="#" class="nav-item"><span>â¤ï¸</span> è‡ªé€‰åŸºé‡‘</a>
            <a href="#" class="nav-item"><span>ğŸ’¼</span> æŒä»“åˆ†æ</a>
            <a href="#" class="nav-item"><span>ğŸ“°</span> èµ„è®¯æ–°é—»</a>
            <div style="height: 20px;"></div>
            <div style="padding: 0 20px; font-size: 12px; color: var(--text-muted);">è´¦æˆ·ç®¡ç†</div>
            <a href="#" class="nav-item"><span>âš™ï¸</span> è®¾ç½®</a>
        </nav>
    </aside>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content">
        <!-- é¡¶éƒ¨æ  -->
        <header>
            <div class="header-left">
                <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
                <div class="market-status">
                    <div class="live-dot"></div> äº¤æ˜“ä¸­ (Live)
                </div>
                <!-- æœç´¢æ¡† (æ¡Œé¢æ˜¾ç¤º) -->
                <input type="text" placeholder="è¾“å…¥ä»£ç /æ‹¼éŸ³..." style="background:var(--bg-body); border:1px solid var(--border); padding:6px 12px; border-radius:4px; color:white; margin-left:10px; display:none;" class="desktop-only">
            </div>
            <div style="display:flex; gap:15px; align-items:center;">
                <span style="font-size:14px; color:var(--text-muted);">ä¸Šè¯: <span class="text-up">3285.42 (+0.5%)</span></span>
                <div style="width:32px; height:32px; background:var(--primary); border-radius:50%; display:flex; align-items:center; justify-content:center;">User</div>
            </div>
        </header>

        <!-- ä»ªè¡¨ç›˜ç½‘æ ¼ -->
        <div class="dashboard-container">
            
            <!-- 1. åŸºé‡‘å¤´éƒ¨ä¿¡æ¯å¡ -->
            <div class="card fund-header-card" id="headerCard">
                <div class="fund-info">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <h1>æ‹›å•†ä¸­è¯ç™½é…’æŒ‡æ•°(LOF)A</h1>
                        <span class="code">161725</span>
                    </div>
                    <div style="color:var(--text-muted); margin-top:5px;">
                        ç±»å‹: æŒ‡æ•°å‹-è‚¡ç¥¨ | é£é™©: é«˜ | è§„æ¨¡: 485.23äº¿
                    </div>
                </div>
                <div class="price-box">
                    <div class="price-main text-up" id="currentPrice">1.2450</div>
                    <div class="price-change text-up" id="priceChange">+2.45% (+0.0298)</div>
                    <div style="font-size:12px; color:var(--text-muted); margin-top:4px;">å®æ—¶ä¼°å€¼ 14:35:02</div>
                </div>
            </div>

            <!-- 2. å®æ—¶èµ°åŠ¿å›¾å¡ç‰‡ -->
            <div class="card chart-card">
                <div class="card-title">
                    <span>èµ°åŠ¿åˆ†æ</span>
                    <div class="chart-controls">
                        <button class="chart-btn active" onclick="switchPeriod('min')">åˆ†æ—¶</button>
                        <button class="chart-btn" onclick="switchPeriod('day')">æ—¥K</button>
                        <button class="chart-btn" onclick="switchPeriod('week')">å‘¨K</button>
                    </div>
                </div>
                <div style="flex:1; position:relative;">
                    <canvas id="mainCanvas"></canvas>
                    <!-- åå­—å‡†æ˜Ÿä¿¡æ¯ (æ‚¬æµ®æ˜¾ç¤º) -->
                    <div id="crosshairInfo" style="position:absolute; top:0; left:0; pointer-events:none; display:none; background:rgba(0,0,0,0.8); padding:4px 8px; border-radius:4px; font-size:12px;"></div>
                </div>
            </div>

            <!-- 3. æŒä»“å½±å“åˆ†æ -->
            <div class="card holdings-card">
                <div class="card-title">
                    <span>é‡ä»“è‚¡å®æ—¶è´¡çŒ®</span>
                    <span style="font-size:12px; color:var(--primary); cursor:pointer;">æŸ¥çœ‹å…¨éƒ¨</span>
                </div>
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>è‚¡ç¥¨åç§°</th>
                            <th style="text-align:right;">ç°ä»·</th>
                            <th style="text-align:right;">æ¶¨è·Œå¹…</th>
                            <th style="text-align:right;" class="mobile-hide">è´¡çŒ®åº¦</th>
                        </tr>
                    </thead>
                    <tbody id="stockListBody">
                        <!-- JS å¡«å……æ•°æ® -->
                    </tbody>
                </table>
            </div>

            <!-- 4. åº•éƒ¨èµ„é‡‘æµå‘ (Webç«¯ä¸“å±) -->
            <div class="card" style="grid-column: 1 / -1;">
                <div class="card-title">æ¿å—èµ„é‡‘æµå‘ (ç™½é…’æ¦‚å¿µ)</div>
                <div style="display:flex; height:20px; background:#334155; border-radius:10px; overflow:hidden;">
                    <div style="width:65%; background:var(--up); display:flex; align-items:center; justify-content:center; font-size:12px;">ä¸»åŠ›æµå…¥ 65%</div>
                    <div style="width:35%; background:var(--down); display:flex; align-items:center; justify-content:center; font-size:12px;">æµå‡º 35%</div>
                </div>
                <div style="display:flex; justify-content:space-between; margin-top:8px; font-size:12px; color:var(--text-muted);">
                    <span>è¶…å¤§å•: +2.5äº¿</span>
                    <span>å¤§å•: -0.8äº¿</span>
                    <span>ä¸­å•: -1.2äº¿</span>
                    <span>å°å•: -0.5äº¿</span>
                </div>
            </div>

        </div>
    </main>

    <!-- é®ç½©å±‚ (ç§»åŠ¨ç«¯èœå•æ‰“å¼€æ—¶) -->
    <div id="overlay" style="position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:90; display:none;" onclick="toggleSidebar()"></div>

    <script>
        // --- 1. å“åº”å¼èœå•é€»è¾‘ ---
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const desktopSearch = document.querySelector('.desktop-only');

        function toggleSidebar() {
            sidebar.classList.toggle('open');
            overlay.style.display = sidebar.classList.contains('open') ? 'block' : 'none';
        }

        // --- 2. æ¨¡æ‹Ÿæ•°æ® ---
        const stocks = [
            { name: "è´µå·èŒ…å°", price: 1780.50, change: 1.2, weight: 15 },
            { name: "äº”ç²®æ¶²", price: 155.20, change: 0.8, weight: 12 },
            { name: "æ³¸å·è€çª–", price: 210.30, change: -0.5, weight: 10 },
            { name: "å±±è¥¿æ±¾é…’", price: 260.00, change: 2.1, weight: 8 },
            { name: "æ´‹æ²³è‚¡ä»½", price: 120.50, change: -1.1, weight: 6 },
            { name: "å¤äº•è´¡é…’", price: 240.10, change: 0.3, weight: 5 },
        ];
        
        let currentFundPrice = 1.2450;
        const yesterdayClose = 1.2152;
        let chartMode = 'min'; // 'min', 'day', 'week'

        // --- 3. æ¸²æŸ“æŒä»“è¡¨æ ¼ ---
        function renderStocks() {
            const tbody = document.getElementById('stockListBody');
            tbody.innerHTML = '';
            
            stocks.forEach(stock => {
                const isUp = stock.change >= 0;
                const colorClass = isUp ? 'text-up' : 'text-down';
                const sign = isUp ? '+' : '';
                const contribution = (stock.change * stock.weight / 100).toFixed(2); // ç®€å•ä¼°ç®—è´¡çŒ®

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div>${stock.name}</div>
                        <div class="stock-bar"><div class="stock-bar-fill" style="width:${stock.weight * 3}%; background:${isUp ? 'var(--up)' : 'var(--down)'}"></div></div>
                    </td>
                    <td style="text-align:right; font-family:'Roboto Mono'">${stock.price.toFixed(2)}</td>
                    <td style="text-align:right;" class="${colorClass}">${sign}${stock.change.toFixed(2)}%</td>
                    <td style="text-align:right; opacity:0.8;" class="mobile-hide ${contribution >=0 ? 'text-up':'text-down'}">${contribution >=0 ? '+':''}${contribution}%</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- 4. Canvas ç»˜åˆ¶åˆ†æ—¶å›¾/è¶‹åŠ¿å›¾ ---
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        let chartData = [];
        let simulationInterval;

        // ç”Ÿæˆåˆå§‹æ•°æ®
        function generateData(type) {
            chartData = [];
            let count = type === 'min' ? 240 : 100; // åˆ†æ—¶240ä¸ªç‚¹ï¼ŒKçº¿æ¨¡æ‹Ÿ100ä¸ªç‚¹
            let base = yesterdayClose;
            let volatility = type === 'min' ? 0.002 : 0.05; // Kçº¿æ³¢åŠ¨æ›´å¤§

            for(let i=0; i<count; i++) {
                let change = (Math.random() - 0.48) * volatility;
                base = base + change;
                chartData.push(base);
            }
            if(type === 'min') currentFundPrice = chartData[chartData.length-1];
        }

        function resizeCanvas() {
            const parent = canvas.parentElement;
            canvas.width = parent.clientWidth;
            canvas.height = parent.clientHeight;
            drawChart();
        }

        function drawChart() {
            const w = canvas.width;
            const h = canvas.height;
            ctx.clearRect(0, 0, w, h);

            // 1. ç»˜åˆ¶ç½‘æ ¼
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            const yMiddle = h / 2;
            ctx.beginPath(); ctx.moveTo(0, yMiddle); ctx.lineTo(w, yMiddle); ctx.stroke();

            if(chartData.length === 0) return;

            // 2. è®¡ç®—æ¯”ä¾‹
            const maxVal = Math.max(...chartData);
            const minVal = Math.min(...chartData);
            const refVal = chartMode === 'min' ? yesterdayClose : (maxVal+minVal)/2;
            const maxDiff = Math.max(Math.abs(maxVal - refVal), Math.abs(minVal - refVal));
            const range = maxDiff * 1.2 || 0.01;
            
            const getY = (val) => yMiddle - ((val - refVal) / range) * (h/2);
            
            // 3. ç»˜åˆ¶å¡«å……åŒº
            const stepX = w / chartData.length;
            
            ctx.beginPath();
            ctx.moveTo(0, yMiddle);
            chartData.forEach((val, i) => ctx.lineTo(i * stepX, getY(val)));
            
            // é—­åˆè·¯å¾„ç”¨äºå¡«å……
            ctx.lineTo((chartData.length -1) * stepX, h);
            ctx.lineTo(0, h);
            
            const gradient = ctx.createLinearGradient(0, 0, 0, h);
            // åˆ†æ—¶å›¾ç”¨çº¢è‰²ï¼Œå‘¨/æ—¥Kç”¨è“è‰²åŒºåˆ«
            const color = chartMode === 'min' ? '239, 68, 68' : '59, 130, 246'; 
            
            gradient.addColorStop(0, `rgba(${color}, 0.2)`);
            gradient.addColorStop(1, `rgba(${color}, 0)`);
            ctx.fillStyle = gradient;
            ctx.fill();

            // 4. ç»˜åˆ¶çº¿æ¡
            ctx.beginPath();
            ctx.setLineDash([]);
            ctx.lineWidth = 2;
            ctx.strokeStyle = `rgb(${color})`;
            chartData.forEach((val, i) => {
                if(i===0) ctx.moveTo(i * stepX, getY(val));
                else ctx.lineTo(i * stepX, getY(val));
            });
            ctx.stroke();

            // 5. å‘¼å¸ç¯ (ä»…åœ¨åˆ†æ—¶æ¨¡å¼æ˜¾ç¤º)
            if(chartMode === 'min') {
                const lastX = (chartData.length -1) * stepX;
                const lastY = getY(chartData[chartData.length-1]);
                ctx.beginPath(); ctx.arc(lastX, lastY, 4, 0, Math.PI*2);
                ctx.fillStyle = `rgb(${color})`; ctx.fill();
            }
        }

        // --- 5. äº¤äº’ä¸APIé€»è¾‘ ---
        
        // åˆ‡æ¢å›¾è¡¨å‘¨æœŸ
        window.switchPeriod = function(type) {
            chartMode = type;
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // æ¨¡æ‹Ÿæ•°æ®é‡æ–°ç”Ÿæˆ
            generateData(type);
            drawChart();
            
            // æ‰“å°çœŸå®APIåœ°å€ä¾›å¼€å‘è€…å‚è€ƒ
            getRealHistoryData(type);
        }

        // â˜…â˜…â˜… æ ¸å¿ƒï¼šçœŸå® API è·å–æŒ‡å— â˜…â˜…â˜…
        function getRealHistoryData(type) {
            const code = 'sz161725'; // ç¤ºä¾‹ä»£ç ï¼šæ‹›å•†ä¸­è¯ç™½é…’ (LOF)
            let url = "";
            let description = "";

            if (type === 'day') {
                // è…¾è®¯è´¢ç» æ—¥K æ¥å£
                // param: å¸‚åœºä»£ç , day, start_date, end_date, count, qfq(å‰å¤æƒ)
                url = `https://web.ifzq.gtimg.cn/appstock/app/fqkline/get?param=${code},day,,,320,qfq`;
                description = "è…¾è®¯è´¢ç» [æ—¥K] æ¥å£";
            } else if (type === 'week') {
                // è…¾è®¯è´¢ç» å‘¨K æ¥å£
                url = `https://web.ifzq.gtimg.cn/appstock/app/fqkline/get?param=${code},week,,,320,qfq`;
                description = "è…¾è®¯è´¢ç» [å‘¨K] æ¥å£";
            } else {
                console.log("åˆ‡æ¢åˆ°åˆ†æ—¶æ¨¡æ‹Ÿæ•°æ®");
                return;
            }

            console.group("ğŸ“Š å¦‚ä½•è·å–çœŸå®æ•°æ®?");
            console.log(`%c${description}`, "color: #3b82f6; font-weight: bold; font-size: 14px;");
            console.log("è¯·æ±‚åœ°å€:", url);
            console.log("æç¤º: åœ¨æµè§ˆå™¨ç›´æ¥æ‰“å¼€é“¾æ¥å¯è§ JSON æ•°æ®ã€‚åœ¨ä»£ç ä¸­ä½¿ç”¨éœ€å¤„ç†è·¨åŸŸ(CORS)æˆ–ä½¿ç”¨JSONPã€‚");
            console.groupEnd();
        }

        // --- 6. å®æ—¶æ¨¡æ‹Ÿå¼•æ“ ---
        function simulateRealtime() {
            if(chartMode !== 'min') return; // åªæœ‰åˆ†æ—¶å›¾æ‰æ¨¡æ‹Ÿè·³åŠ¨

            const lastIdx = chartData.length - 1;
            chartData[lastIdx] = chartData[lastIdx] + (Math.random()-0.5) * 0.0005;
            
            const newPrice = chartData[lastIdx];
            const oldPrice = currentFundPrice;
            currentFundPrice = newPrice;
            
            // æ›´æ–° DOM
            const priceEl = document.getElementById('currentPrice');
            const changeEl = document.getElementById('priceChange');
            const headerCard = document.getElementById('headerCard');
            
            priceEl.innerText = newPrice.toFixed(4);
            const change = newPrice - yesterdayClose;
            const pct = (change / yesterdayClose) * 100;
            const isUp = change >= 0;
            
            changeEl.innerText = `${(isUp?'+':'')}${pct.toFixed(2)}% (${(isUp?'+':'')}${change.toFixed(4)})`;
            priceEl.className = `price-main ${isUp ? 'text-up' : 'text-down'}`;
            changeEl.className = `price-change ${isUp ? 'text-up' : 'text-down'}`;
            
            if(Math.abs(newPrice - oldPrice) > 0.0001) {
                headerCard.classList.remove('bg-flash-up', 'bg-flash-down');
                void headerCard.offsetWidth; 
                headerCard.classList.add(isUp ? 'bg-flash-up' : 'bg-flash-down');
            }
            
            renderStocks();
            drawChart();
        }

        // åˆå§‹åŒ–
        generateData('min');
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas(); 
        renderStocks();
        setInterval(simulateRealtime, 2000); 

        if(window.innerWidth > 768) {
            desktopSearch.style.display = 'block';
        }
        window.addEventListener('resize', () => {
             desktopSearch.style.display = window.innerWidth > 768 ? 'block' : 'none';
        });

    </script>
</body>
</html>